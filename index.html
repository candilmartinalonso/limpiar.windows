<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimizador Leviat√°n v8.1 - Suite de Rendimiento Total</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
        }
        .glass-effect {
            background: rgba(13, 17, 23, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .code-block::-webkit-scrollbar { width: 8px; height: 8px; }
        .code-block::-webkit-scrollbar-thumb { background: #be123c; border-radius: 4px; }
        .code-block::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); }
        .btn-glow:hover { box-shadow: 0 0 25px 8px rgba(225, 29, 72, 0.4); }
        .text-shadow-red { text-shadow: 0 0 15px rgba(225, 29, 72, 0.6); }
        #copy-toast {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="text-gray-200 min-h-screen bg-cover bg-center bg-fixed" style="background-image: url('https://placehold.co/1920x1080/0d1117/be123c?text=LEVIATAN')">
    <div class="absolute inset-0 bg-black/80"></div>

    <!-- Toast Notification -->
    <div id="copy-toast" class="fixed top-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transform translate-y-2">
        ¬°Script copiado al portapapeles!
    </div>

    <div class="relative container mx-auto px-4 py-8 md:py-16">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-7xl font-black text-white tracking-tighter mb-4 text-shadow-red">
                Optimizador Leviat√°n v8.1
            </h1>
            <p class="text-lg md:text-xl text-rose-300 max-w-3xl mx-auto">
                La suite de rendimiento definitiva inspirada en System Mechanic Pro. Limpia, acelera, protege y repara tu sistema con un poder sin precedentes.
            </p>
        </header>

        <!-- Main Content -->
        <main class="max-w-6xl mx-auto">
            <!-- Code Block Section -->
            <div class="glass-effect rounded-2xl p-6 md:p-8 mb-12">
                <div class="flex flex-col md:flex-row justify-between items-start gap-4 mb-4">
                    <h2 class="text-2xl font-bold text-white tracking-tighter">Script PowerShell - v8.1 Corregido y Mejorado</h2>
                    <button id="copyButton" class="w-full md:w-auto bg-rose-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 btn-glow hover:bg-rose-600 focus:outline-none focus:ring-4 focus:ring-rose-500">
                        Copiar Script Leviat√°n
                    </button>
                </div>
                
                <!-- Code Display -->
                <div class="bg-black/70 rounded-lg overflow-hidden border border-white/10">
                    <pre class="code-block language-powershell p-4 text-sm overflow-x-auto h-[550px]"><code id="powerShellScript"># =================================================================================================
#
#   PowerScript Optimizador LEVIAT√ÅN v8.1 - Edici√≥n Mec√°nico del Sistema (Corregido)
#   Inspirado en las capacidades de System Mechanic Pro para una optimizaci√≥n integral.
#   Objetivo: Limpieza, aceleraci√≥n, protecci√≥n y reparaci√≥n del sistema a nivel experto.
#
#   ADVERTENCIA: EJECUTAR SIEMPRE COMO ADMINISTRADOR.
#   Este script realiza cambios profundos (incluyendo en el registro). √ösese bajo su propia responsabilidad.
#
# =================================================================================================

#region PREPARACI√ìN Y CONFIGURACI√ìN INICIAL
if (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Write-Warning "Este script requiere privilegios de Administrador. Por favor, reinicia la terminal como Administrador."
    Start-Sleep -Seconds 10
    Exit
}

function Show-SectionTitle {
    param([string]$Title)
    Write-Host "`n"
    Write-Host "==================================================================" -ForegroundColor Magenta
    Write-Host "    $Title" -ForegroundColor White
    Write-Host "==================================================================" -ForegroundColor Magenta
}

$logFile = "$env:USERPROFILE\Desktop\Optimizador-Leviatan-Log.txt"
Function Write-Log {
    param ([string]$Message, [string]$ForegroundColor = 'Gray')
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $logMessage = "[$timestamp] - $Message"
    $logMessage | Out-File -FilePath $logFile -Append
    Write-Host $logMessage -ForegroundColor $foregroundColor
}

function Create-RestorePoint {
    Show-SectionTitle "Creando Punto de Restauraci√≥n del Sistema"
    try {
        if (-NOT (Get-Service -Name VSS -ErrorAction SilentlyContinue).Status -eq "Running") {
            Write-Log "El servicio de Volume Shadow Copy no est√° activo. Intentando iniciarlo." -ForegroundColor Yellow
            Start-Service -Name VSS
            Start-Sleep -Seconds 2
        }
        if (Get-WmiObject -Class Win32_ComputerSystem | Select-Object -ExpandProperty "SystemRestoreEnabled") {
            Write-Log "Creando punto de restauraci√≥n 'Pre-Leviatan-v8.1-Optimizer'..."
            $restorePoint = Checkpoint-Computer -Description "Pre-Leviatan-v8.1-Optimizer" -RestorePointType "MODIFY_SETTINGS" -ErrorAction Stop
            Write-Log "Punto de restauraci√≥n creado con √©xito." -ForegroundColor Green
        } else {
            Write-Log "La creaci√≥n de puntos de restauraci√≥n parece estar deshabilitada en tu sistema. Omitiendo." -ForegroundColor Red
        }
    } catch {
        Write-Log "No se pudo crear un nuevo punto de restauraci√≥n. Motivo: $($_.Exception.Message)" -ForegroundColor Yellow
    }
}
#endregion

#region MODULO 1: LIMPIEZA PROFUNDA
function Invoke-ExhaustiveClean {
    Show-SectionTitle "Limpieza Exhaustiva de Archivos Basura"
    $locationsToClean = @(
        "$env:TEMP\*", "$env:SystemRoot\Temp\*", "$env:SystemRoot\SoftwareDistribution\Download\*",
        "$env:windir\Prefetch\*", "$env:windir\Logs\*", "$env:windir\Panther\*",
        "$env:LOCALAPPDATA\Microsoft\Edge\User Data\Default\Cache\*", 
        "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Cache\*",
        "$env:LOCALAPPDATA\Discord\Cache\*", "$env:APPDATA\Steam\htmlcache\*",
        "$env:LOCALAPPDATA\NVIDIA\GLCache\*", "$env:LOCALAPPDATA\AMD\DxCache\*",
        "$env:windir\logs\CBS\*", "$env:windir\panther\*", "$env:ProgramData\Microsoft\WER\ReportQueue\*",
        "$env:SystemRoot\System32\Winevt\Logs\*"
    )
    foreach ($location in $locationsToClean) {
        Write-Log "Limpiando: $location"
        Remove-Item -Path $location -Recurse -Force -ErrorAction SilentlyContinue
    }
    Write-Log "Vaciando registros de eventos, DNS y Papelera..."
    wevtutil el | ForEach-Object { wevtutil cl "$_" -ErrorAction SilentlyContinue }
    ipconfig /flushdns | Out-Null
    Clear-RecycleBin -Force -ErrorAction SilentlyContinue
    Write-Log "Limpiando el almac√©n de componentes de Windows (WinSxS)..."
    Dism.exe /online /Cleanup-Image /StartComponentCleanup | Out-Null
    Write-Log "Limpieza de archivos completada." -ForegroundColor Green
}

function Invoke-RegistryClean {
    Show-SectionTitle "Limpieza del Registro (Funci√≥n Experimental)"
    Write-Warning "¬°PELIGRO! Modificar el registro incorrectamente puede causar inestabilidad en el sistema."
    $confirmation = Read-Host "¬øEst√°s SEGURO de que deseas continuar? (S/N)"
    if ($confirmation -ne 's') { Write-Log "Operaci√≥n cancelada." -ForegroundColor Yellow; return }

    Write-Log "Buscando claves de software obsoleto..."
    $uninstallPaths = @("HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall", "HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall")
    foreach ($path in $uninstallPaths) {
        Get-ChildItem -Path $path -ErrorAction SilentlyContinue | ForEach-Object {
            $displayName = $_.GetValue("DisplayName")
            $installLocation = $_.GetValue("InstallLocation")
            if ($displayName -and $installLocation -and -not (Test-Path $installLocation)) {
                Write-Log "Obsoleto encontrado: $displayName." -ForegroundColor Yellow
            }
        }
    }
    Write-Log "An√°lisis de software obsoleto completado. Se recomienda revisi√≥n manual." -ForegroundColor Green
    
    Write-Log "Limpiando claves de MRU (Most Recently Used)..."
    Remove-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRU\*" -Force -ErrorAction SilentlyContinue
    Write-Log "Limpieza del registro finalizada (modo seguro)." -ForegroundColor Green
}

function Invoke-BloatwareRemoval {
    Show-SectionTitle "Depuraci√≥n Profunda de Windows (Bloatware)"
    Import-Module Appx -ErrorAction SilentlyContinue
    Import-Module Dism -ErrorAction SilentlyContinue
     $appsToRemove = @(
        "Microsoft.549981C3F5F10", "*Cortana*", "Microsoft.WindowsSoundRecorder", 
        "Microsoft.Xbox*", "Microsoft.ZuneMusic", "Microsoft.ZuneVideo", "Microsoft.YourPhone", 
        "Microsoft.WindowsAlarms", "Microsoft.WindowsMaps", "Microsoft.SkypeApp", "Microsoft.Getstarted", 
        "Microsoft.GetHelp", "Microsoft.MicrosoftSolitaireCollection", "Microsoft.People", "Microsoft.Office.OneNote", 
        "Microsoft.OneConnect", "Microsoft.Print3D", "Microsoft.Wallet", "Microsoft.MixedReality.Portal", 
        "Microsoft.WindowsFeedbackHub", "Microsoft.BingWeather", "Microsoft.GetOffice", "Microsoft.WindowsCamera"
    )
    $confirmation = Read-Host "¬øEst√°s seguro de que deseas eliminar estas apps? (S/N)"
    if ($confirmation -eq 's') {
        foreach ($app in $appsToRemove) {
            Write-Log "Intentando eliminar: $app"
            Get-AppxPackage -AllUsers $app | Remove-AppxPackage -AllUsers -ErrorAction SilentlyContinue
            Get-AppxProvisionedPackage -Online | Where-Object { $_.PackageName -like $app } | Remove-AppxProvisionedPackage -Online -ErrorAction SilentlyContinue
        }
        Write-Log "Depuraci√≥n de bloatware completada." -ForegroundColor Green
    } else { Write-Log "Operaci√≥n de depuraci√≥n cancelada." -ForegroundColor Yellow }
}
#endregion

#region MODULO 2: ACELERACI√ìN
function Invoke-FreeRAM {
    Show-SectionTitle "Liberando Memoria RAM (T√©cnica Avanzada)"
    try {
        $Code = @"
        using System; using System.Runtime.InteropServices;
        public class MemTool { [DllImport("ntdll.dll")] public static extern int NtSetSystemInformation(int infoClass, IntPtr info, int len); }
"@
        Add-Type -TypeDefinition $Code
        $ptr = [System.Runtime.InteropServices.Marshal]::AllocHGlobal(4)
        [System.Runtime.InteropServices.Marshal]::WriteInt32($ptr, 2)
        [MemTool]::NtSetSystemInformation(80, $ptr, 4)
        [System.Runtime.InteropServices.Marshal]::FreeHGlobal($ptr)
        Write-Log "Memoria en espera liberada exitosamente." -ForegroundColor Green
    } catch { Write-Log "Error al liberar memoria RAM: $_" -ForegroundColor Red }
}

function Invoke-Defrag {
    Show-SectionTitle "An√°lisis y Desfragmentaci√≥n de Disco"
    Write-Log "Analizando estado del disco principal (C:)..."
    defrag.exe C: /A /U /V
    $confirmation = Read-Host "¬øDeseas optimizar (desfragmentar) el disco C: ahora? (S/N)"
    if ($confirmation -eq 's') {
        Write-Log "Iniciando optimizaci√≥n. Esto puede tardar."
        defrag.exe C: /O
        Write-Log "Optimizaci√≥n de disco completada." -ForegroundColor Green
    } else { Write-Log "Operaci√≥n cancelada." -ForegroundColor Yellow }
}

function Invoke-ExtremeOptimization {
    Show-SectionTitle "Aplicando Optimizaciones Extremas Seguras"
    Write-Log "Activando plan 'M√°ximo Rendimiento' y optimizando sistema..."
    powercfg -duplicatescheme e9a42b02-d5df-448d-aa00-03f14749eb61 | Out-Null
    $maxPerfGuid = ((powercfg -l | Select-String "M√°ximo rendimiento").Line -split " ")[3]
    if ($maxPerfGuid) {
        powercfg /s $maxPerfGuid
        Write-Log "Plan de energ√≠a 'M√°ximo Rendimiento' activado." -ForegroundColor Green
    } else {
        Write-Log "No se pudo encontrar el plan de energ√≠a 'M√°ximo Rendimiento'." -ForegroundColor Yellow
    }
    powercfg.exe /hibernate off
    fsutil behavior set disablelastaccess 1
    Set-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control" -Name "WaitToKillServiceTimeout" -Value "2000"
    Write-Log "Activando Hardware-Accelerated GPU Scheduling..."
    Set-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\GraphicsDrivers" -Name "HwSchMode" -Value 2 -Type Dword -Force -ErrorAction SilentlyContinue
    Write-Log "Optimizaciones de red avanzadas..."
    netsh int tcp set global autotuninglevel=normal
    Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile" -Name "NetworkThrottlingIndex" -Value 0xFFFFFFFF -Type DWord -Force
    Write-Log "Optimizaciones completadas." -ForegroundColor Green
}
#endregion

#region MODULO 3: PROTECCI√ìN Y PRIVACIDAD
function Invoke-SecurityCheck {
    Show-SectionTitle "Revisi√≥n de Seguridad de Windows"
    $firewall = Get-NetFirewallProfile | Where-Object {$_.Enabled -eq 'True'}
    if ($firewall) { Write-Log "Firewall de Windows: ACTIVADO." -ForegroundColor Green }
    else { Write-Log "Firewall de Windows: DESACTIVADO." -ForegroundColor Red }
    
    $av = Get-MpComputerStatus
    if ($av.AntivirusEnabled) { Write-Log "Microsoft Defender: ACTIVADO." -ForegroundColor Green }
    else { Write-Log "Microsoft Defender: DESACTIVADO." -ForegroundColor Red }
    Write-Log "Revisi√≥n de seguridad b√°sica completada." -ForegroundColor Green
}

function Invoke-PrivacyShield {
    Show-SectionTitle "Escudo de Privacidad (Anti-Telemetr√≠a)"
    Write-Log "Desactivando servicios de telemetr√≠a y recolecci√≥n de datos..."
    $servicesToDisable = @("DiagTrack", "dmwappushservice", "DoSvc")
    foreach ($service in $servicesToDisable) {
        Write-Log "Desactivando servicio: $service"
        Set-Service -Name $service -StartupType Disabled -Status Stopped -ErrorAction SilentlyContinue
    }
    Set-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\DataCollection" -Name "AllowTelemetry" -Value 0 -Type DWord -Force
    Write-Log "Escudo de privacidad activado." -ForegroundColor Green
}

function Invoke-UniversalUpdate {
    Show-SectionTitle "Buscando Actualizaciones (Sistema y Apps)"
    Write-Log "Fase 1: Actualizando Windows..."
    Install-Module -Name PSWindowsUpdate -Force -AcceptLicense -ErrorAction SilentlyContinue | Out-Null
    Import-Module PSWindowsUpdate -ErrorAction SilentlyContinue
    Get-WindowsUpdate -AcceptAll -Install -AutoReboot | Out-Null
    Write-Log "Sistema Operativo Windows actualizado." -ForegroundColor Green
    
    Write-Log "Fase 2: Actualizando aplicaciones con Winget..."
    if (Get-Command "winget" -ErrorAction SilentlyContinue) {
        winget upgrade --all --accept-package-agreements --accept-source-agreements --disable-interactivity
        Write-Log "Aplicaciones de Winget actualizadas." -ForegroundColor Green
    } else { Write-Log "Winget no encontrado." -ForegroundColor Yellow }
}
#endregion

#region MODULO 4: REPARACI√ìN
function Invoke-SystemRepair {
    Show-SectionTitle "Reparaci√≥n Integral del Sistema"
    Write-Log "Verificando y reparando integridad de archivos (SFC)..."
    sfc /scannow
    Write-Log "Verificando y reparando imagen de componentes (DISM)..."
    Dism /Online /Cleanup-Image /RestoreHealth
    Write-Log "Mantenimiento completado." -ForegroundColor Green
}

function Invoke-NetworkRepair {
    Show-SectionTitle "Reparaci√≥n de Conexi√≥n de Red"
    Write-Warning "Esto reiniciar√° tus adaptadores de red y puede requerir que te reconectes a tu WiFi."
    $confirmation = Read-Host "¬øEst√°s seguro de que deseas continuar? (S/N)"
    if ($confirmation -ne 's') { Write-Log "Operaci√≥n cancelada." -ForegroundColor Yellow; return }

    ipconfig /flushdns
    nbtstat -R
    nbtstat -RR
    netsh int ip reset all
    netsh winsock reset
    Write-Log "La reparaci√≥n de red ha finalizado. Se recomienda reiniciar el equipo." -ForegroundColor Green
}

function Invoke-DiskCheck {
    Show-SectionTitle "Reparaci√≥n de Errores de Disco (CHKDSK)"
    Write-Warning "Esta operaci√≥n requiere un REINICIO para escanear el disco del sistema."
    $confirmation = Read-Host "¬øProgramar un CHKDSK en el pr√≥ximo reinicio? (S/N)"
    if ($confirmation -eq 's') {
        chkdsk C: /f /r
        Write-Log "CHKDSK programado. Reinicia tu PC para comenzar." -ForegroundColor Green
    } else { Write-Log "Operaci√≥n cancelada." -ForegroundColor Yellow }
}
#endregion

#region MENUS
function Show-MainMenu {
    Clear-Host
    Write-Host "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó" -ForegroundColor Magenta
    Write-Host "‚ïë        üê≤ OPTIMIZADOR LEVIAT√ÅN v8.1 - Edici√≥n Mec√°nico üê≤         ‚ïë" -ForegroundColor White
    Write-Host "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù" -ForegroundColor Magenta
    Write-Host ""
    Write-Host "ADVERTENCIA: Herramienta de poder extremo. Proceda con precauci√≥n." -ForegroundColor Red
    Write-Host ""
    Write-Host "Selecciona una categor√≠a:" -ForegroundColor Magenta
    Write-Host "   [1] Limpieza Profunda"
    Write-Host "   [2] Aceleraci√≥n del Sistema"
    Write-Host "   [3] Protecci√≥n y Privacidad"
    Write-Host "   [4] Reparaci√≥n del Sistema"
    Write-Host "   [5] Diagn√≥stico"
    Write-Host "   [A] ¬°MODO APOCALIPSIS!"
    Write-Host "   [R] Crear Punto de Restauraci√≥n"
    Write-Host "   [Q] Salir"
    Write-Host ""
}

function Show-CleaningMenu {
    do {
        Clear-Host
        Write-Host "--- Men√∫ de Limpieza Profunda ---" -ForegroundColor Cyan
        Write-Host "   [1] Limpieza Exhaustiva de Archivos Basura"
        Write-Host "   [2] Limpieza del Registro (Experimental)"
        Write-Host "   [3] Eliminaci√≥n de Bloatware"
        Write-Host "   [4] Ejecutar TODO en esta categor√≠a"
        Write-Host "   [B] Volver al Men√∫ Principal"
        $choice = Read-Host "Selecciona una opci√≥n"
        switch ($choice) {
            "1" { Invoke-ExhaustiveClean }
            "2" { Invoke-RegistryClean }
            "3" { Invoke-BloatwareRemoval }
            "4" { Invoke-ExhaustiveClean; Invoke-RegistryClean; Invoke-BloatwareRemoval }
            "b" { break }
            default { Write-Host "Opci√≥n no v√°lida." -ForegroundColor Yellow; Start-Sleep -Seconds 1 }
        }
        if ($choice -in '1'..'4') { Write-Host "Operaci√≥n completada. Presiona Enter..."; Read-Host | Out-Null }
    } while ($choice -ne 'b')
}

function Show-SpeedupMenu {
    do {
        Clear-Host
        Write-Host "--- Men√∫ de Aceleraci√≥n ---" -ForegroundColor Cyan
        Write-Host "   [1] Liberaci√≥n de Memoria RAM"
        Write-Host "   [2] Desfragmentaci√≥n y Optimizaci√≥n de Disco"
        Write-Host "   [3] Aplicar Optimizaciones Extremas (Red, UI, Energ√≠a)"
        Write-Host "   [4] Ejecutar TODO en esta categor√≠a"
        Write-Host "   [B] Volver al Men√∫ Principal"
        $choice = Read-Host "Selecciona una opci√≥n"
        switch ($choice) {
            "1" { Invoke-FreeRAM }
            "2" { Invoke-Defrag }
            "3" { Invoke-ExtremeOptimization }
            "4" { Invoke-FreeRAM; Invoke-Defrag; Invoke-ExtremeOptimization }
            "b" { break }
            default { Write-Host "Opci√≥n no v√°lida." -ForegroundColor Yellow; Start-Sleep -Seconds 1 }
        }
        if ($choice -in '1'..'4') { Write-Host "Operaci√≥n completada. Presiona Enter..."; Read-Host | Out-Null }
    } while ($choice -ne 'b')
}

function Show-ProtectionMenu {
     do {
        Clear-Host
        Write-Host "--- Men√∫ de Protecci√≥n y Privacidad ---" -ForegroundColor Cyan
        Write-Host "   [1] Revisi√≥n de Seguridad (Firewall, Antivirus)"
        Write-Host "   [2] Activar Escudo de Privacidad (Anti-Telemetr√≠a)"
        Write-Host "   [3] B√∫squeda Universal de Actualizaciones"
        Write-Host "   [4] Ejecutar TODO en esta categor√≠a"
        Write-Host "   [B] Volver al Men√∫ Principal"
        $choice = Read-Host "Selecciona una opci√≥n"
        switch ($choice) {
            "1" { Invoke-SecurityCheck }
            "2" { Invoke-PrivacyShield }
            "3" { Invoke-UniversalUpdate }
            "4" { Invoke-SecurityCheck; Invoke-PrivacyShield; Invoke-UniversalUpdate }
            "b" { break }
            default { Write-Host "Opci√≥n no v√°lida." -ForegroundColor Yellow; Start-Sleep -Seconds 1 }
        }
        if ($choice -in '1'..'4') { Write-Host "Operaci√≥n completada. Presiona Enter..."; Read-Host | Out-Null }
    } while ($choice -ne 'b')
}

function Show-RepairMenu {
    do {
        Clear-Host
        Write-Host "--- Men√∫ de Reparaci√≥n del Sistema ---" -ForegroundColor Cyan
        Write-Host "   [1] Reparar Archivos de Sistema (SFC y DISM)"
        Write-Host "   [2] Reiniciar Pila de Red (Soluciona problemas de conexi√≥n)"
        Write-Host "   [3] Programar Comprobaci√≥n de Disco (CHKDSK al reiniciar)"
        Write-Host "   [4] Ejecutar TODO en esta categor√≠a"
        Write-Host "   [B] Volver al Men√∫ Principal"
        $choice = Read-Host "Selecciona una opci√≥n"
        switch ($choice) {
            "1" { Invoke-SystemRepair }
            "2" { Invoke-NetworkRepair }
            "3" { Invoke-DiskCheck }
            "4" { Invoke-SystemRepair; Invoke-NetworkRepair; Invoke-DiskCheck }
            "b" { break }
            default { Write-Host "Opci√≥n no v√°lida." -ForegroundColor Yellow; Start-Sleep -Seconds 1 }
        }
        if ($choice -in '1'..'4') { Write-Host "Operaci√≥n completada. Presiona Enter..."; Read-Host | Out-Null }
    } while ($choice -ne 'b')
}

function Show-DiagnosticsMenu {
    Show-SectionTitle "Realizando Diagn√≥stico Avanzado del Sistema"
    $reportPath = "$env:USERPROFILE\Desktop\Diagnostico-Leviatan.txt"
    "Reporte de Diagn√≥stico - $(Get-Date)" | Out-File -FilePath $reportPath
    (systeminfo) | Out-File -FilePath $reportPath -Append
    ("`n--- Top 10 Procesos por CPU ---`n") | Out-File -FilePath $reportPath -Append
    (Get-Process | Sort-Object CPU -Descending | Select-Object -First 10 | Format-Table | Out-String) | Out-File -FilePath $reportPath -Append
    ("`n--- Top 10 Procesos por RAM ---`n") | Out-File -FilePath $reportPath -Append
    (Get-Process | Sort-Object WorkingSet -Descending | Select-Object -First 10 | Format-Table | Out-String) | Out-File -FilePath $reportPath -Append
    Write-Log "Diagn√≥stico completado. Revisa el archivo en tu escritorio." -ForegroundColor Green
    Invoke-Item $reportPath
}
#endregion

#region BUCLE PRINCIPAL
do {
    Show-MainMenu
    $option = Read-Host "Selecciona una opci√≥n"
    switch ($option) {
        "1" { Show-CleaningMenu }
        "2" { Show-SpeedupMenu }
        "3" { Show-ProtectionMenu }
        "4" { Show-RepairMenu }
        "5" { Show-DiagnosticsMenu; Write-Host "Presiona Enter..."; Read-Host | Out-Null }
        "a" { 
            Create-RestorePoint
            Invoke-ExhaustiveClean
            Invoke-BloatwareRemoval
            Invoke-ExtremeOptimization
            Invoke-PrivacyShield
            Invoke-SystemRepair
            Invoke-FreeRAM
            Write-Log "¬°MODO APOCALIPSIS COMPLETADO! Se recomienda reiniciar." -ForegroundColor Magenta
        }
        "r" { Create-RestorePoint }
        "q" { Write-Host "Saliendo del Optimizador Leviat√°n." -ForegroundColor Green }
        default { Write-Host "Opci√≥n no v√°lida." -ForegroundColor Yellow; Start-Sleep -Seconds 1 }
    }
    if ($option -ne 'q' -and $option -ne '5' -and -not ($option -match "[1-4]")) {
        Write-Host "`nOperaci√≥n completada. Presiona Enter para volver al men√∫..." -ForegroundColor Magenta
        Read-Host | Out-Null
    }
} while ($option -ne 'q')
#endregion
</code></pre>
                </div>
            </div>
        </main>
    </div>

    <script>
        const copyButton = document.getElementById('copyButton');
        const powerShellScript = document.getElementById('powerShellScript').textContent;
        const toast = document.getElementById('copy-toast');

        copyButton.addEventListener('click', () => {
            const textArea = document.createElement('textarea');
            textArea.value = powerShellScript;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";

            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    toast.classList.remove('opacity-0', 'translate-y-2');
                    toast.classList.add('opacity-100', 'translate-y-0');
                    setTimeout(() => {
                        toast.classList.remove('opacity-100', 'translate-y-0');
                        toast.classList.add('opacity-0', 'translate-y-2');
                    }, 3000);
                } else {
                    alert('Hubo un error al intentar copiar el script.');
                }
            } catch (err) {
                alert('Hubo un error al intentar copiar el script.');
            }

            document.body.removeChild(textArea);
        });
    </script>
</body>
</html>

