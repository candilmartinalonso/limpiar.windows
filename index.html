<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimizador Leviat√°n para Windows - Script de Poder Extremo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
        }
        .glass-effect {
            background: rgba(13, 17, 23, 0.5);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .code-block::-webkit-scrollbar { width: 8px; height: 8px; }
        .code-block::-webkit-scrollbar-thumb { background: #06b6d4; border-radius: 4px; }
        .code-block::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); }
        .btn-glow:hover { box-shadow: 0 0 25px 8px rgba(6, 182, 212, 0.4); }
        .text-shadow-cyan { text-shadow: 0 0 15px rgba(6, 182, 212, 0.6); }
    </style>
</head>
<body class="text-gray-200">
    <div class="min-h-screen bg-cover bg-center bg-fixed" style="background-image: url('https://placehold.co/1920x1080/0d1117/06b6d4?text=LEVIATAN')">
        <div class="absolute inset-0 bg-black/70"></div>
        <div class="relative container mx-auto px-4 py-8 md:py-16">
            <header class="text-center mb-12">
                <h1 class="text-4xl md:text-7xl font-black text-white tracking-tighter mb-4 text-shadow-cyan">
                    Optimizador Leviat√°n
                </h1>
                <p class="text-lg md:text-xl text-cyan-300 max-w-3xl mx-auto">
                    El poder abismal del rendimiento liberado. Un script de PowerShell definitivo para limpiar, actualizar, depurar y acelerar tu sistema hasta el l√≠mite.
                </p>
            </header>
            
            <main class="max-w-6xl mx-auto">
                <div class="glass-effect rounded-2xl p-6 md:p-8 mb-12">
                    <div class="flex flex-col md:flex-row justify-between items-start mb-4 gap-4">
                        <h2 class="text-2xl font-bold text-white tracking-tighter mb-4">Script de PowerShell v7.0 - Leviat√°n</h2>
                        <button id="copyButton" class="w-full md:w-auto bg-cyan-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 btn-glow hover:bg-cyan-500 focus:outline-none focus:ring-4 focus:ring-cyan-400">
                            Copiar Script Leviat√°n
                        </button>
                    </div>
                    <div class="bg-black/70 rounded-lg overflow-hidden border border-white/10">
                        <pre class="code-block language-powershell p-4 text-sm overflow-x-auto h-[550px]"><code id="powerShellScript">// =================================================================================================
//
//   PowerScript Optimizador LEVIAT√ÅN v7.0
//   Objetivo: Limpieza exhaustiva, optimizaci√≥n extrema, mantenimiento preventivo y diagn√≥stico avanzado.
//
//   ADVERTENCIA: EJECUTAR SIEMPRE COMO ADMINISTRADOR.
//   Este script realiza cambios profundos. √ösese bajo su propia responsabilidad.
//
// =================================================================================================
#region PREPARACI√ìN Y CONFIGURACI√ìN INICIAL
if (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Write-Warning "Este script requiere privilegios de Administrador. Por favor, reinicia la terminal como Administrador."
    Start-Sleep -Seconds 10
    Exit
}

function Show-SectionTitle {
    param([string]$Title)
    Write-Host "`n"
    Write-Host "==================================================================" -ForegroundColor Cyan
    Write-Host "    $Title" -ForegroundColor White
    Write-Host "==================================================================" -ForegroundColor Cyan
}

$logFile = "$env:USERPROFILE\Desktop\Optimizador-Leviatan-Log.txt"
Function Write-Log {
    param ([string]$Message, [string]$ForegroundColor = 'Gray')
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $logMessage = "[$timestamp] - $Message"
    $logMessage | Out-File -FilePath $logFile -Append
    Write-Host $logMessage -ForegroundColor $ForegroundColor
}

function Show-Menu {
    Clear-Host
    Write-Host "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó" -ForegroundColor Cyan
    Write-Host "‚ïë              üê≤ OPTIMIZADOR LEVIAT√ÅN PARA WINDOWS üê≤             ‚ïë" -ForegroundColor White
    Write-Host "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù" -ForegroundColor Cyan
    Write-Host ""
    Write-Host "ADVERTENCIA: Herramienta de poder extremo. Proceda con precauci√≥n." -ForegroundColor Red
    Write-Host "Se recomienda encarecidamente cerrar todos los programas." -ForegroundColor Yellow
    Write-Host ""
    Write-Host "Selecciona una opci√≥n:" -ForegroundColor Cyan
    Write-Host "   [1] Limpieza Exhaustiva Profunda"
    Write-Host "   [2] Actualizaci√≥n Universal Completa"
    Write-Host "   [3] Optimizaci√≥n Extrema y de Red"
    Write-Host "   [4] Depuraci√≥n Profunda de Windows"
    Write-Host "   [5] Liberaci√≥n de Memoria RAM Avanzada"
    Write-Host "   [6] Mantenimiento Integral del Sistema"
    Write-Host "   [7] Diagn√≥stico Avanzado del Sistema"
    Write-Host "   [8] Utilidades del Sistema"
    Write-Host "   [9] ¬°MODO APOCALIPSIS! (Todo en Orden √ìptimo)"
    Write-Host "   [Q] Salir"
    Write-Host ""
}

function Create-RestorePoint {
    Show-SectionTitle "Creando Punto de Restauraci√≥n del Sistema"
    if (-NOT (Get-Service -Name VSS -ErrorAction SilentlyContinue).Status -eq "Running") {
        Write-Log "El servicio de Volume Shadow Copy no est√° activo. Intentando iniciarlo." -ForegroundColor Yellow
        Start-Service -Name VSS
        Start-Sleep -Seconds 2
    }
    if ((Get-ComputerRestorePoint -ErrorAction SilentlyContinue).Count -gt 0) {
        Write-Log "Creando punto de restauraci√≥n 'Pre-Leviatan-Optimizer'..."
        Checkpoint-Computer -Description "Pre-Leviatan-Optimizer" -RestorePointType "MODIFY_SETTINGS"
        Write-Log "Punto de restauraci√≥n creado con √©xito." -ForegroundColor Green
    } else {
        Write-Log "La creaci√≥n de puntos de restauraci√≥n parece estar deshabilitada en tu sistema. Omitiendo." -ForegroundColor Red
    }
}
#endregion

#region FUNCIONES PRINCIPALES MEJORADAS
# --- [1] LIMPIEZA EXHAUSTIVA PROFUNDA ---
function Invoke-ExhaustiveClean {
    Show-SectionTitle "Iniciando Limpieza Exhaustiva Profunda"
    $initialDiskSpace = (Get-PSDrive C).Free
    
    Write-Log "Limpieza de cach√©s del sistema, navegadores y aplicaciones..."
    $locationsToClean = @(
        # Archivos temporales del sistema
        "$env:TEMP\*", "$env:SystemRoot\Temp\*", "$env:SystemRoot\SoftwareDistribution\Download\*",
        "$env:windir\Prefetch\*", "$env:windir\Logs\*", "$env:windir\Panther\*",
        "$env:SystemRoot\System32\Winevt\Logs\*",
        
        # Navegadores
        "$env:LOCALAPPDATA\Microsoft\Edge\User Data\Default\Cache\*", 
        "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Cache\*",
        "$env:LOCALAPPDATA\Mozilla\Firefox\Profiles\*\cache2\entries\*",
        "$env:LOCALAPPDATA\BraveSoftware\Brave-Browser\User Data\Default\Cache\*",
        "$env:LOCALAPPDATA\Vivaldi\User Data\Default\Cache\*",
        
        # Aplicaciones Populares
        "$env:LOCALAPPDATA\Discord\Cache\*", "$env:APPDATA\Discord\Cache\*",
        "$env:APPDATA\Spotify\Cache\*", "$env:APPDATA\Steam\htmlcache\*",
        "$env:APPDATA\VSCode\Cache\*", "$env:APPDATA\VSCode\CachedData\*",
        "$env:LOCALAPPDATA\GitHub Desktop\Cache\*",
        "$env:LOCALAPPDATA\Zoom\*\Cache\*", "$env:LOCALAPPDATA\Telegram Desktop\*\Cache\*",
        "$env:LOCALAPPDATA\Microsoft\Teams\Cache\*", "$env:LOCALAPPDATA\Microsoft\Teams\blob_storage\*",
        "$env:LOCALAPPDATA\Notion\Resources\app.asar.unpacked\static\js\cache\*",
        
        # Logs y Registros
        "$env:APPDATA\Microsoft\Windows\Recent\AutomaticDestinations\*", 
        "$env:APPDATA\Microsoft\Windows\Recent\CustomDestinations\*",
        "$env:APPDATA\Microsoft\Windows\Recent\Destinations\*",
        "$env:APPDATA\Microsoft\Windows\Recent\JumpLists\*",
        "$env:APPDATA\Microsoft\Windows\Recent\TypedPaths\*",
        "$env:APPDATA\Microsoft\Windows\Recent\WorkFolders\*",
        
        # Otros
        "$env:USERPROFILE\AppData\LocalLow\Sun\Java\Deployment\cache\*",
        "$env:USERPROFILE\AppData\Roaming\Microsoft\Windows\WebCache\*",
        "$env:LOCALAPPDATA\NVIDIA\GLCache\*", "$env:LOCALAPPDATA\AMD\DxCache\*",
        "$env:LOCALAPPDATA\Microsoft\Windows\INetCache\*",
        "$env:LOCALAPPDATA\Microsoft\Office\16.0\OfficeFileCache\*",
        "$env:LOCALAPPDATA\Packages\Microsoft.WindowsStore_8wekyb3d8bbwe\LocalCache\*",
        "$env:windir\logs\CBS\*", "$env:windir\panther\*", "$env:ProgramData\Microsoft\WER\ReportQueue\*",
        "$env:SystemRoot\System32\Winevt\Logs\*"
    )
    
    foreach ($location in $locationsToClean) {
        Write-Log "Limpiando: $location"
        Remove-Item -Path $location -Recurse -Force -ErrorAction SilentlyContinue
    }

    Write-Log "Vaciando registros de eventos de Windows..."
    wevtutil el | ForEach-Object { wevtutil cl "$_" }
    
    Write-Log "Limpieza de cach√© de DNS y Papelera de Reciclaje..."
    Clear-DnsClientCache; ipconfig /flushdns
    Clear-RecycleBin -Force -ErrorAction SilentlyContinue
    Remove-Item -Path "$env:windir\SoftwareDistribution\Download\*" -Recurse -Force
    
    Write-Log "Ejecutando Liberador de espacio en disco de Windows en modo avanzado..."
    $regKey = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\VolumeCaches"
    Get-ChildItem -Path $regKey | ForEach-Object {Set-ItemProperty -Path $_.PSPath -Name "StateFlags0001" -Value 2 -Type DWord -Force -ErrorAction SilentlyContinue} | Out-Null
    cleanmgr.exe /sagerun:1 | Out-Null
    Write-Log "Limpiando el almac√©n de componentes de Windows (WinSxS)..."
    Dism.exe /online /Cleanup-Image /StartComponentCleanup | Out-Null
    
    $finalDiskSpace = (Get-PSDrive C).Free
    $spaceFreed = [math]::Round(($finalDiskSpace - $initialDiskSpace) / 1GB, 2)
    Write-Log "Limpieza Exhaustiva Finalizada. Espacio liberado: $spaceFreed GB" -ForegroundColor Green
}

# --- [2] ACTUALIZACI√ìN UNIVERSAL COMPLETA ---
function Invoke-UniversalUpdate {
    Show-SectionTitle "Iniciando Actualizaci√≥n Universal Completa"
    
    Write-Log "Fase 1: Actualizando Windows..."
    Write-Log "Esto puede tardar MUCHO tiempo. Ten paciencia."
    Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force -ErrorAction SilentlyContinue | Out-Null
    Install-Module -Name PSWindowsUpdate -Force -AcceptLicense -ErrorAction SilentlyContinue | Out-Null
    Import-Module PSWindowsUpdate -ErrorAction SilentlyContinue
    Get-WindowsUpdate -AcceptAll -Install -AutoReboot | Out-Null
    Write-Log "Sistema Operativo Windows actualizado." -ForegroundColor Green
    
    Write-Log "Fase 2: Actualizando aplicaciones con Winget..."
    if (Get-Command "winget" -ErrorAction SilentlyContinue) {
        winget upgrade --all --accept-package-agreements --accept-source-agreements --disable-interactivity
        Write-Log "Aplicaciones de Winget actualizadas." -ForegroundColor Green
    } else { Write-Log "Winget no encontrado." -ForegroundColor Yellow }
    
    Write-Log "Fase 3: Actualizando aplicaciones con Chocolatey..."
    if (Get-Command "choco" -ErrorAction SilentlyComplete) {
        choco upgrade all -y --ignore-checksums
        Write-Log "Aplicaciones de Chocolatey actualizadas." -ForegroundColor Green
    } else { Write-Log "Chocolatey no encontrado." -ForegroundColor Yellow }
    
    Write-Log "Fase 4: Actualizando aplicaciones con Scoop..."
    if (Get-Command "scoop" -ErrorAction SilentlyComplete) {
        scoop update *; scoop cleanup *
        Write-Log "Aplicaciones de Scoop actualizadas." -ForegroundColor Green
    } else { Write-Log "Scoop no encontrado." -ForegroundColor Yellow }
    
    Write-Log "Fase 5: Actualizando drivers con Snappy Driver Installer..."
    if (Test-Path "C:\SnappyDriverInstaller_x64\SdiGui.exe") {
        Start-Process "C:\SnappyDriverInstaller_x64\SdiGui.exe" -ArgumentList "/update" -Wait
        Write-Log "Drivers actualizados con Snappy Driver Installer." -ForegroundColor Green
    } else {
        Write-Log "Snappy Driver Installer no encontrado. Considera instalarlo manualmente." -ForegroundColor Yellow
    }
    
    Write-Log "Fase 6: Actualizando firmware de dispositivos..."
    if (Get-Command "fwupdmgr" -ErrorAction SilentlyComplete) {
        fwupdmgr refresh
        fwupdmgr update --force
        Write-Log "Firmware actualizado." -ForegroundColor Green
    } else { Write-Log "fwupdmgr no encontrado." -ForegroundColor Yellow }
}

# --- [3] OPTIMIZACI√ìN EXTREMA Y DE RED ---
function Invoke-ExtremeOptimization {
    Show-SectionTitle "Aplicando Optimizaciones Extremas Seguras"
    Write-Log "Activando plan de energ√≠a de 'M√°ximo Rendimiento' y desactivando hibernaci√≥n..."
    powercfg -duplicatescheme e9a42b02-d5df-448d-aa00-03f14749eb61 | Out-Null
    $planGuid = (powercfg -l | Select-String "M√°ximo rendimiento" -split " ")[3]
    powercfg /s $planGuid
    powercfg.exe /hibernate off
    
    Write-Log "Optimizaciones de sistema y UI..."
    fsutil behavior set disablelastaccess 1
    Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects" -Name "VisualFxSetting" -Value 2
    Set-ItemProperty -Path "HKCU:\ControlPanel\Desktop" -Name "MenuShowDelay" -Value "0"
    Set-ItemProperty -Path "HKCU:\ControlPanel\Desktop" -Name "AutoEndTasks"
