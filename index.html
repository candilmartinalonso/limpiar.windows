<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimizador Leviatán v10.0 - Edición Extrema</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
        }
        .glass-effect {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .code-block::-webkit-scrollbar { width: 8px; height: 8px; }
        .code-block::-webkit-scrollbar-thumb { background: #f59e0b; border-radius: 4px; }
        .code-block::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); }
        .btn-glow:hover { box-shadow: 0 0 25px 8px rgba(245, 158, 11, 0.4); }
        .text-shadow-amber { text-shadow: 0 0 15px rgba(245, 158, 11, 0.6); }
        #copy-toast { transition: opacity 0.3s, transform 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 1s ease-out forwards; }
    </style>
</head>
<body class="text-gray-200 min-h-screen bg-cover bg-center bg-fixed" style="background-image: url('https://placehold.co/1920x1080/111827/f59e0b?text=LEVIATAN')">
    <div class="absolute inset-0 bg-black/85"></div>

    <!-- Toast Notification -->
    <div id="copy-toast" class="fixed top-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transform translate-y-2 z-50">
        ¡Script copiado al portapapeles!
    </div>

    <div class="relative container mx-auto px-4 py-8 md:py-16">
        <!-- Header -->
        <header class="text-center mb-12 fade-in">
            <h1 class="text-4xl md:text-7xl font-black text-white tracking-tighter mb-4 text-shadow-amber">
                Optimizador Leviatán v10.0
            </h1>
            <p class="text-lg md:text-xl text-amber-300 max-w-3xl mx-auto">
                Edición Extrema: Desata el máximo potencial de tu sistema con optimizaciones a nivel de kernel, servicios y red.
            </p>
        </header>

        <!-- Main Content -->
        <main class="max-w-6xl mx-auto">
            <!-- Instructions Section -->
            <div class="glass-effect rounded-2xl p-6 md:p-8 mb-8 fade-in" style="animation-delay: 200ms;">
                <h2 class="text-2xl font-bold text-white tracking-tighter mb-4">Instrucciones de Uso</h2>
                <ol class="list-decimal list-inside space-y-2 text-gray-300">
                    <li>Abre **Terminal (Administrador)**. Haz clic derecho en el menú Inicio y selecciónalo.</li>
                    <li>Haz clic en el botón de abajo para copiar el script completo.</li>
                    <li>Vuelve a la terminal, haz clic derecho para pegar y presiona **Enter**.</li>
                    <li>Navega por el menú con los números y sigue las instrucciones.</li>
                </ol>
            </div>
            
            <!-- Code Block Section -->
            <div class="glass-effect rounded-2xl p-6 md:p-8 fade-in" style="animation-delay: 400ms;">
                <div class="flex flex-col md:flex-row justify-between items-start gap-4 mb-4">
                    <h2 class="text-2xl font-bold text-white tracking-tighter">Script PowerShell - v10.0 Edición Extrema</h2>
                    <button id="copyButton" class="w-full md:w-auto bg-amber-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 btn-glow hover:bg-amber-500 focus:outline-none focus:ring-4 focus:ring-amber-400">
                        Copiar Script Leviatán
                    </button>
                </div>
                
                <!-- Code Display -->
                <div class="bg-black/70 rounded-lg overflow-hidden border border-white/10">
                    <pre class="code-block language-powershell p-4 text-sm overflow-x-auto h-[550px]"><code id="powerShellScript"># =================================================================================================
#
#   PowerScript Optimizador LEVIATÁN v10.0 - Edición Extrema
#   Objetivo: Limpieza, aceleración y optimización profunda del sistema.
#
#   ADVERTENCIA: EJECUTAR SIEMPRE COMO ADMINISTRADOR.
#   Este script realiza cambios profundos. Úsese bajo su propia responsabilidad.
#
# =================================================================================================

#region PREPARACIÓN Y CONFIGURACIÓN INICIAL
if (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Write-Warning "Este script requiere privilegios de Administrador. Por favor, reinicia la terminal como Administrador."
    Start-Sleep -Seconds 10
    Exit
}

function Show-SectionTitle {
    param([string]$Title)
    Write-Host "`n"; Write-Host "==================================================================" -ForegroundColor Yellow
    Write-Host "    $Title" -ForegroundColor White
    Write-Host "==================================================================" -ForegroundColor Yellow
}

$logFile = "$env:USERPROFILE\Desktop\Optimizador-Leviatan-Log-v10.0.txt"
Function Write-Log {
    param ([string]$Message, [string]$ForegroundColor = 'Gray')
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $logMessage = "[$timestamp] - $Message"
    $logMessage | Out-File -FilePath $logFile -Append
    Write-Host $logMessage -ForegroundColor $foregroundColor
}

Write-Log "Inicio del script Leviatán v10.0."
#endregion

#region CONFIGURACIÓN CENTRALIZADA
$config = @{
    LocationsToClean = @(
        "$env:TEMP", "$env:SystemRoot\Temp", "$env:SystemRoot\SoftwareDistribution\Download",
        "$env:windir\Prefetch", "$env:windir\Logs", "$env:windir\Panther",
        "$env:LOCALAPPDATA\Microsoft\Edge\User Data\Default\Cache", "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Cache",
        "$env:LOCALAPPDATA\Discord\Cache", "$env:APPDATA\Steam\htmlcache",
        "$env:LOCALAPPDATA\NVIDIA\GLCache", "$env:LOCALAPPDATA\AMD\DxCache", "$env:windir\logs\CBS"
    )
    AppsToRemove = @(
        "Microsoft.549981C3F5F10", "*Cortana*", "Microsoft.WindowsSoundRecorder", "Microsoft.Xbox*", "Microsoft.ZuneMusic", 
        "Microsoft.ZuneVideo", "Microsoft.YourPhone", "Microsoft.WindowsAlarms", "Microsoft.WindowsMaps", "Microsoft.SkypeApp",
        "Microsoft.Getstarted", "Microsoft.GetHelp", "Microsoft.MicrosoftSolitaireCollection", "Microsoft.People", "Microsoft.Office.OneNote",
        "Microsoft.OneConnect", "Microsoft.Print3D", "Microsoft.Wallet", "Microsoft.MixedReality.Portal", "Microsoft.WindowsFeedbackHub",
        "Microsoft.BingWeather", "Microsoft.GetOffice", "Microsoft.WindowsCamera"
    )
    AppsToExclude = @("Microsoft.XboxGameOverlay", "Microsoft.XboxGamingOverlay", "Microsoft.XboxSpeechToTextOverlay")
    ServicesToDisable = @(
        "DiagTrack", "dmwappushservice", "DoSvc", "MapsBroker", "SysMain", "PcaSvc"
    )
    UltimatePerformanceGuid = "e9a42b02-d5df-448d-aa00-03f14749eb61"
}
#endregion

#region FUNCIONES CORE
function Create-RestorePoint {
    Show-SectionTitle "Creando Punto de Restauración del Sistema"
    try {
        $restoreService = Get-Service -Name "VSS" -ErrorAction SilentlyContinue
        if ($restoreService -and $restoreService.Status -eq 'Running') {
            Write-Log "Intentando crear punto de restauración 'Pre-Leviatan-v10.0'..."
            $restorePoint = Checkpoint-Computer -Description "Pre-Leviatan-v10.0" -RestorePointType "MODIFY_SETTINGS" -ErrorAction SilentlyContinue
            if ($LASTEXITCODE -eq 0) {
                 Write-Log "Punto de restauración creado con éxito." -ForegroundColor Green
            } else {
                Write-Log "No se creó un nuevo punto de restauración. Puede que ya exista uno reciente." -ForegroundColor Yellow
                Write-Log "Detalle: $($restorePoint.ToString())" -ForegroundColor DarkGray
            }
        } else {
            Write-Log "El servicio de restauración (VSS) no está activo. Omitiendo." -ForegroundColor Yellow
        }
    } catch {
        Write-Log "Error crítico al crear punto de restauración: $($_.Exception.Message)" -ForegroundColor Red
    }
}

# --- MÓDULO 1: LIMPIEZA ---
function Invoke-ExhaustiveClean {
    Show-SectionTitle "Limpieza Exhaustiva de Archivos Basura"
    foreach ($location in $config.LocationsToClean) {
        $path = Join-Path $location -ChildPath "*"
        if (Test-Path $location) {
            Write-Log "Limpiando: $path"
            Remove-Item -Path $path -Recurse -Force -ErrorAction SilentlyContinue
        } else { Write-Log "Omitiendo ruta no encontrada: $location" -ForegroundColor DarkGray }
    }
    Write-Log "Vaciando registros de eventos, DNS y Papelera..."
    $eventLogs = wevtutil el | Where-Object { $_ }
    foreach ($log in $eventLogs) {
        try { wevtutil cl "$log" -ErrorAction Stop | Out-Null } catch { Write-Log "No se pudo limpiar el registro: $log" -ForegroundColor DarkYellow }
    }
    ipconfig /flushdns | Out-Null
    Clear-RecycleBin -Force -ErrorAction SilentlyContinue
    Write-Log "Limpiando almacén de componentes de Windows (WinSxS)..."
    Dism.exe /online /Cleanup-Image /StartComponentCleanup /ResetBase | Out-Null
    Write-Log "Limpieza de archivos completada." -ForegroundColor Green
}

function Invoke-BloatwareRemoval {
    Show-SectionTitle "Depuración Profunda de Windows (Bloatware)"
    $confirmation = Read-Host "¿Deseas eliminar las apps predefinidas de Windows? Esta acción es irreversible. (S/N)"
    if ($confirmation.ToLower() -ne 's') { Write-Log "Operación cancelada." -ForegroundColor Yellow; return }
    
    Import-Module Appx -Force
    Import-Module Dism -Force

    foreach ($app in $config.AppsToRemove) {
        Write-Log "Intentando eliminar patrón: $app"
        $packages = Get-AppxPackage -AllUsers -Name $app | Where-Object { $config.AppsToExclude -notcontains $_.Name }
        if ($packages) { $packages | Remove-AppxPackage -AllUsers -ErrorAction SilentlyContinue }
        
        $provisioned = Get-AppxProvisionedPackage -Online | Where-Object { $_.PackageName -like $app -and $config.AppsToExclude -notcontains $_.PackageName }
        if ($provisioned) { $provisioned | Remove-AppxProvisionedPackage -Online -ErrorAction SilentlyContinue }
    }
    Write-Log "Depuración de bloatware completada." -ForegroundColor Green
}

# --- MÓDULO 2: ACELERACIÓN ---
function Invoke-PerformanceBoost {
    Show-SectionTitle "Aplicando Optimizaciones de Rendimiento"
    Write-Log "Activando plan 'Máximo Rendimiento'..."
    if (-not (powercfg /l | Where-Object { $_ -match $config.UltimatePerformanceGuid })) {
        powercfg -duplicatescheme $config.UltimatePerformanceGuid | Out-Null
    }
    powercfg /s $config.UltimatePerformanceGuid
    Write-Log "'Máximo Rendimiento' activado." -ForegroundColor Green
    
    Write-Log "Desactivando hibernación para liberar espacio..."
    powercfg.exe /hibernate off
    
    Write-Log "Optimizando la gestión de archivos y servicios..."
    fsutil behavior set disablelastaccess 1
    Set-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control" -Name "WaitToKillServiceTimeout" -Value "2000" -ErrorAction SilentlyContinue

    Write-Log "Activando Hardware-Accelerated GPU Scheduling..."
    Set-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\GraphicsDrivers" -Name "HwSchMode" -Value 2 -Type Dword -Force -ErrorAction SilentlyContinue
    Write-Log "Aceleración de rendimiento completada." -ForegroundColor Green
}

function Invoke-NetworkBoost {
    Show-SectionTitle "Potenciador de Red (TCP Optimizer)"
    Write-Log "Aplicando ajustes de TCP para baja latencia..."
    netsh int tcp set global autotuninglevel=normal
    netsh int tcp set global ecncapability=enabled
    netsh int tcp set global congestionprovider=ctcp
    Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile" -Name "NetworkThrottlingIndex" -Value 0xFFFFFFFF -Type DWord -Force -ErrorAction SilentlyContinue
    Write-Log "Potenciador de red aplicado." -ForegroundColor Green
}

# --- MÓDULO 3: SERVICIOS Y KERNEL ---
function Invoke-ServiceTuning {
    Show-SectionTitle "Afinación de Servicios de Windows"
    $confirmation = Read-Host "¿Desactivar servicios no esenciales (SysMain, Maps, etc.)? Puede mejorar el rendimiento. (S/N)"
    if ($confirmation.ToLower() -ne 's') { Write-Log "Operación cancelada." -ForegroundColor Yellow; return }
    
    foreach ($service in $config.ServicesToDisable) {
        try {
            Set-Service -Name $service -StartupType Disabled -Status Stopped -ErrorAction Stop
            Write-Log "Servicio '$service' desactivado."
        } catch { Write-Log "No se pudo desactivar el servicio '$service' (puede que no exista)." -ForegroundColor Yellow }
    }
    Write-Log "Afinación de servicios completada." -ForegroundColor Green
}

function Invoke-KernelTuning {
    Show-SectionTitle "Afinación del Kernel (Timer Resolution)"
    Write-Warning "Esto puede mejorar la latencia en juegos pero aumentar el consumo de energía."
    $confirmation = Read-Host "¿Estás SEGURO de que quieres forzar la resolución del temporizador a 0.5ms? (S/N)"
    if ($confirmation.ToLower() -ne 's') { Write-Log "Operación cancelada." -ForegroundColor Yellow; return }

    $code = @"
    [DllImport("ntdll.dll", SetLastError = true)]
    public static extern int NtSetTimerResolution(int DesiredResolution, bool Set, out int CurrentResolution);
"@
    Add-Type -MemberDefinition $code -Name "WinAPI" -Namespace "System"
    [System.WinAPI]::NtSetTimerResolution(5000, $true, [ref]0) | Out-Null
    Write-Log "Resolución del temporizador del sistema ajustada a 0.5ms." -ForegroundColor Green
}

function Invoke-DisableVisualFX {
    Show-SectionTitle "Desactivando Efectos Visuales para Máxima Velocidad de UI"
    $confirmation = Read-Host "¿Deseas desactivar animaciones y sombras para una interfaz más rápida? (S/N)"
    if ($confirmation.ToLower() -ne 's') { Write-Log "Operación cancelada." -ForegroundColor Yellow; return }
    
    # Establecer "Ajustar para obtener el mejor rendimiento"
    Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects" -Name "VisualFxSetting" -Value 2 -Force
    # Desactivar explícitamente efectos clave
    Set-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name "DragFullWindows" -Value "0" -Force
    Set-ItemProperty -Path "HKCU:\Control Panel\Desktop\WindowMetrics" -Name "MinAnimate" -Value "0" -Force
    Write-Log "Efectos visuales desactivados. Puede requerir un reinicio para aplicar todo." -ForegroundColor Green
}

# --- MÓDULO 4: REPARACIÓN Y DIAGNÓSTICO ---
function Invoke-SystemRepair {
    Show-SectionTitle "Reparación Integral del Sistema"
    Write-Log "Verificando y reparando integridad de archivos (SFC)..."; sfc /scannow
    Write-Log "Verificando y reparando imagen de componentes (DISM)..."; Dism /Online /Cleanup-Image /RestoreHealth
    Write-Log "Mantenimiento completado." -ForegroundColor Green
}

function Get-DiskHealth {
    Show-SectionTitle "Diagnóstico de Salud de Discos Físicos"
    try {
        $disks = Get-PhysicalDisk | Select-Object DeviceID, Model, MediaType, HealthStatus, Size
        if (-not $disks) { Write-Log "No se pudieron obtener datos de los discos." -ForegroundColor Red; return }
        Write-Log "Reporte de salud de las unidades de almacenamiento:" -ForegroundColor Cyan
        $disks | Format-Table -AutoSize | Out-String | Write-Host
    } catch { Write-Log "Error al obtener la información del disco: $($_.Exception.Message)" -ForegroundColor Red }
}
#endregion

#region MENÚ PRINCIPAL
function Show-MainMenu {
    Clear-Host
    Write-Host "╔══════════════════════════════════════════════════════════════════╗" -ForegroundColor Yellow
    Write-Host "║         🐲 OPTIMIZADOR LEVIATÁN v10.0 - Edición Extrema 🐲        ║" -ForegroundColor White
    Write-Host "╚══════════════════════════════════════════════════════════════════╝" -ForegroundColor Yellow
    Write-Host "`nADVERTENCIA: Herramienta de poder extremo. Proceda con precaución." -ForegroundColor Red
    Write-Host "`nSelecciona una categoría:" -ForegroundColor Yellow
    Write-Host "   [1] Limpieza y Depuración (Archivos basura y Bloatware)"
    Write-Host "   [2] Aceleración de Sistema y Red"
    Write-Host "   [3] Optimización de Servicios y Kernel (Avanzado)"
    Write-Host "   [4] Optimización de Almacenamiento (SSD/HDD)"
    Write-Host "   [5] Reparación y Diagnóstico del Sistema"
    Write-Host "   [A] ¡MODO APOCALIPSIS! (Ejecuta las optimizaciones más seguras)"
    Write-Host "   [R] Crear Punto de Restauración"
    Write-Host "   [Q] Salir del Script"
}
#endregion

#region BUCLE PRINCIPAL
do {
    Show-MainMenu
    $option = (Read-Host "`nTu elección").ToLower()
    switch ($option) {
        "1" { Invoke-ExhaustiveClean; Invoke-BloatwareRemoval }
        "2" { Invoke-PerformanceBoost; Invoke-NetworkBoost }
        "3" { Invoke-ServiceTuning; Invoke-KernelTuning; Invoke-DisableVisualFX }
        "4" { Invoke-StorageOptimization }
        "5" { Invoke-SystemRepair; Get-DiskHealth }
        "a" { 
            Create-RestorePoint
            Invoke-BloatwareRemoval
            Invoke-PerformanceBoost
            Invoke-NetworkBoost
            Invoke-ServiceTuning
            Invoke-SystemRepair
            Invoke-ExhaustiveClean
            Write-Host "`n¡MODO APOCALIPSIS COMPLETADO! Se recomienda reiniciar." -ForegroundColor Yellow
        }
        "r" { Create-RestorePoint }
        "q" { Write-Log "Saliendo del Optimizador Leviatán."; Write-Host "Saliendo..." -ForegroundColor Green }
        default { Write-Host "Opción no válida." -ForegroundColor Yellow; Start-Sleep -Seconds 1 }
    }
    if ($option -in '1','2','3','4','5','a','r') {
        Write-Host "`nOperación completada. Presiona Enter para volver al menú..."
        Read-Host | Out-Null
    }
} while ($option -ne 'q')
#endregion
</code></pre>
                </div>
            </div>
        </main>
    </div>

    <script>
        (() => {
            const copyButton = document.getElementById('copyButton');
            const scriptContent = document.getElementById('powerShellScript').textContent;
            const toast = document.getElementById('copy-toast');

            const copyScriptToClipboard = async () => {
                try {
                    await navigator.clipboard.writeText(scriptContent);
                    showToast(true);
                } catch (err) {
                    console.warn('Async clipboard copy failed, falling back to execCommand.', err);
                    fallbackCopy();
                }
            };

            const fallbackCopy = () => {
                const textArea = document.createElement('textarea');
                textArea.value = scriptContent;
                textArea.style.position = "fixed";
                textArea.style.top = "0";
                textArea.style.left = "0";
                textArea.style.opacity = "0";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    const successful = document.execCommand('copy');
                    showToast(successful);
                } catch (err) {
                    console.error('Fallback copy failed:', err);
                    showToast(false);
                }
                document.body.removeChild(textArea);
            };

            const showToast = (success) => {
                toast.textContent = success ? '¡Script copiado al portapapeles!' : 'Error al copiar el script.';
                toast.className = `fixed top-5 right-5 text-white py-2 px-4 rounded-lg shadow-lg transform transition-all duration-300 ${success ? 'bg-green-500' : 'bg-red-500'} opacity-100 translate-y-0`;
                setTimeout(() => {
                    toast.className = toast.className.replace('opacity-100 translate-y-0', 'opacity-0 translate-y-2');
                }, 3000);
            };

            copyButton.addEventListener('click', copyScriptToClipboard);
        })();
    </script>
</body>
</html>

